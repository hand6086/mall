<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hand.base.brandpromotion.dao.mybatis.mapper.BrandPromotionSchemaMapper">
	<resultMap type="com.hand.base.brandpromotion.model.BrandPromotionSchema" id="brandPromotionSchema"></resultMap>
	
	<sql id="queryAllSql">
		SELECT 
			 T1.ROW_ID            as id                  /*记录ID*/
			,T1.CREATED           as created             /*创建时间*/
			,T1.CREATED_BY        as createdBy           /*创建者ID*/
			,DATE_FORMAT(T1.LAST_UPD, '%Y-%m-%d %H:%k:%S') as lastUpdated         /*最后更新时间*/
			,T1.LAST_UPD_BY       as lastUpdatedBy       /*最后更新者ID*/
			,T1.SCHEMA_NAME       as schemaName          /*方案名称*/
			,date_format(T1.T_ATTR_13, '%Y-%m-%d %H:%i:%S') as tattr13            /*报名开始时间*/
			,date_format(T1.T_ATTR_14, '%Y-%m-%d %H:%i:%S') as tattr14            /*报名结束时间*/
			,t1.TYPE 			  as type				 /*促销形式*/
			,date_format(t1.START_DATE, '%Y-%m-%d %H:%i:%S') as startDate		  /*活动开始时间*/
			,date_format(t1.END_DATE, '%Y-%m-%d %H:%i:%S') as endDate			  /*活动结束时间*/
			,t1.BRAND_STATUS      as brandStatus  		 /*品牌馆方案状态*/
			,t1.COMMENTS 		  as comments 			 /*说明*/
			,t1.PIC_ID			  as picId				 /*图片ID*/
			,T1.SOURCE            as source 			 /*频道类型*/
			,t4.row_id 			  as orgId
			,t6.PATH			  as path				 /*图片路径*/
	</sql>
	
	<sql id="fromTableSql">
		FROM
			LNK_SALE_SCHEMA t1
				LEFT JOIN (
					LNK_INTER_CITY_SALE t2
					LEFT JOIN (
						CX_O_AREA t3
						LEFT JOIN lnk_org_ext t4 ON t4.ROW_ID = t3.T_ATTR_05
					) ON t3.row_id = t2.city_id
				) ON t2.sale_schema_id = t1.row_id
				LEFT JOIN lnk_emp_info t5 on t1.CREATED_BY = t5.row_id
				LEFT JOIN cx_o_img t6 on t1.PIC_ID = t6.row_id
		WHERE 1=1
	</sql>
	
	<sql id="whereAllSql">
		AND T1.SOURCE = 'brand'
		AND T1.corp_id = #{usercorpid}
	</sql>
	
	<!-- 记录总数 -->
	<select id="queryCountByExample" resultType="java.lang.Integer" parameterType="com.hand.base.brandpromotion.model.BrandPromotionSchema">
		SELECT count(1)
		<include refid="fromTableSql"/>
		<include refid="whereAllSql"/>
	</select>
	
	<select id="queryByExamplePage" resultMap="brandPromotionSchema"
		parameterType="com.hand.base.brandpromotion.model.BrandPromotionSchema">
		<include refid="queryAllSql"/>
		<include refid="fromTableSql"/>
		<include refid="whereAllSql"/>
	</select>
	
	<select id="queryById" resultMap="brandPromotionSchema"
		parameterType="com.hand.base.brandpromotion.model.BrandPromotionSchema">
		<include refid="queryAllSql"/>
		<include refid="fromTableSql"/>
		and T1.ROW_ID=#{id}
	</select>
	
	<select id="queryAll" resultMap="brandPromotionSchema"
		parameterType="com.hand.base.brandpromotion.model.BrandPromotionSchema">
		<include refid="queryAllSql"/>
		<include refid="fromTableSql"/>
		<include refid="whereAllSql"/>
	</select>

	<insert id="insert" parameterType="com.hand.base.brandpromotion.model.BrandPromotionSchema">
		INSERT INTO LNK_SALE_SCHEMA(
		 ROW_ID              /*记录ID*/
		,SCHEMA_NAME         /*方案名称*/
		,PIC_ID         	 /*方案图片*/
		,T_ATTR_13           /*报名开始时间*/
		,T_ATTR_14           /*报名结束时间*/
		,TYPE           	 /*促销形式*/
		,START_DATE          /*活动开始时间*/
		,END_DATE            /*活动结束时间*/
		,BRAND_STATUS        /*方案状态*/
		,COMMENTS            /*方案说明*/
		,SOURCE              /*频道类型*/
		) values (
		 #{id}               /*记录ID*/
		,#{schemaName}       /*方案名称*/
		,#{picId}         	 /*方案图片*/
		,#{tattr13}          /*报名开始时间*/
		,#{tattr14}          /*报名结束时间*/
		,#{type}        	 /*促销形式*/
		,#{startDate}        /*活动开始时间*/
		,#{endDate}          /*活动结束时间*/
		,#{brandStatus}      /*方案状态*/
		,#{comments}         /*方案说明*/
		,'brand'         /*方案说明*/
		)
	</insert>

	<update id="update" parameterType="com.hand.base.brandpromotion.model.BrandPromotionSchema">
		UPDATE LNK_SALE_SCHEMA 
		SET
			 SCHEMA_NAME         =#{schemaName}       /*方案名称*/
			,PIC_ID         	 =#{picId}         	  /*方案图片*/
			,T_ATTR_13           =#{tattr13}          /*报名开始时间*/
			,T_ATTR_14           =#{tattr14}          /*报名结束时间*/
			,TYPE           	 =#{type}        	  /*促销形式*/
			,START_DATE          =#{startDate}        /*活动开始时间*/
			,END_DATE            =#{endDate}          /*活动结束时间*/
			,BRAND_STATUS        =#{brandStatus}      /*方案状态*/
			,COMMENTS  			 =#{comments}         /*方案说明*/
		WHERE ROW_ID=#{id}
	</update>
	<delete id="deleteById" parameterType="com.hand.base.brandpromotion.model.BrandPromotionSchema">
		DELETE FROM LNK_SALE_SCHEMA WHERE ROW_ID=#{id}
	</delete>
</mapper>
