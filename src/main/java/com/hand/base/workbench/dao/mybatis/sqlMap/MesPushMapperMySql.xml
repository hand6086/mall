<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hand.base.workbench.dao.mybatis.mapper.MesPushMapper">
	<resultMap type="com.hand.base.workbench.model.MesPush" id="mesPush"></resultMap>

	<sql id="queryAllSql">
		select
		T.ROW_ID as id,
		date_format(T.CREATED,'%Y-%m-%d %H:%i:%S') as created,
		T.CREATED_BY as createdBy,
		date_format(T.LAST_UPD, '%Y-%m-%d %H:%i:%S') as lastUpdated,
		T.LAST_UPD_BY as lastUpdatedBy,
	    t.T_ATTR_01 pushType,
		t.T_ATTR_04 messagePushType,
		t.OBJECT_TYPE objectType,
		t.PUSH_TEXT pushText,
		date_format(t.T_ATTR_13, '%Y-%m-%d %H:%i:%S') as startTime,
		date_format(t.T_ATTR_14, '%Y-%m-%d %H:%i:%S') expireTime,
		t.PUSH_FLG isPushed,
		t.ACTIVE_FLAG activeFlag,
		t.T_ATTR_02 city,
		t.T_ATTR_03 cityId,
		t2.row_id orgId
	</sql>

	<sql id="fromSql">
		from CX_O_PUSH_DTL t
		left join (CX_O_AREA t1  LEFT JOIN lnk_org_ext T2 ON T2.ROW_ID = T1.T_ATTR_05) on t1.row_id=t.T_ATTR_03
  	</sql>
  	
  	<sql id="whereAllSql">
  		where 1 = 1
  		and t.T_ATTR_04 is not null
  	</sql>
  	
  	<select id="queryByExamplePage" parameterType="com.hand.base.workbench.model.MesPush" resultMap="mesPush">
  		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		<include refid="whereAllSql"/>
		and t.corp_id = #{usercorpid}
		order by t.CREATED desc
  	</select>
  	
  	<select id="brandQueryByExamplePage" parameterType="com.hand.base.workbench.model.MesPush" resultMap="mesPush">
  		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		<include refid="whereAllSql"/>
		<if test="usersystemRole != 'super_administrator' ">
			and t.corp_id = #{usercorpid}
		 </if>
		 <if test="usersystemRole == 'super_administrator' ">
			and t.corp_id != '101'
		 </if>
		order by t.CREATED desc
  	</select>
  	
  	 	
	<select id="queryById" resultType="com.hand.base.workbench.model.MesPush"
		parameterType="com.hand.base.workbench.model.MesPush">		
		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		where t.ROW_ID=#{id}
	</select>
  	 	
	<select id="brandQueryById" resultType="com.hand.base.workbench.model.MesPush"
		parameterType="com.hand.base.workbench.model.MesPush">		
		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		where t.ROW_ID=#{id}
	</select>
  	
  	<insert id="insert" parameterType="com.hand.base.workbench.model.MesPush">
		insert into CX_O_PUSH_DTL
		  (ROW_ID, T_ATTR_01, T_ATTR_04,OBJECT_TYPE,object_id,PUSH_TEXT,user_id
		  ,T_ATTR_13,T_ATTR_14
		  , PUSH_FLG,ACTIVE_FLAG,T_ATTR_03,T_ATTR_02)
		values
		  (#{id},#{pushType},#{messagePushType},#{objectType},#{objectId},#{pushText},#{userId}
		  ,lnk_blank_str_to_null(#{startTime,jdbcType=TIMESTAMP})
		  ,lnk_blank_str_to_null(#{expireTime,jdbcType=TIMESTAMP})
		  ,#{isPushed},#{activeFlag},#{cityId},#{city})
	</insert>
  	
  	<insert id="brandInsert" parameterType="com.hand.base.workbench.model.MesPush">
		insert into CX_O_PUSH_DTL
		  (ROW_ID, T_ATTR_01, T_ATTR_04,OBJECT_TYPE,object_id,PUSH_TEXT,user_id
		  ,T_ATTR_13,T_ATTR_14
		  , PUSH_FLG,ACTIVE_FLAG,T_ATTR_03,T_ATTR_02)
		values
		  (#{id},#{pushType},#{messagePushType},#{objectType},#{objectId},#{pushText},#{userId}
		  ,lnk_blank_str_to_null(#{startTime,jdbcType=TIMESTAMP})
		  ,lnk_blank_str_to_null(#{expireTime,jdbcType=TIMESTAMP})
		  ,#{isPushed},#{activeFlag},#{cityId},#{city})
	</insert>
  
	<update id="update" parameterType="com.hand.base.workbench.model.MesPush">
		update CX_O_PUSH_DTL t
		   set t.T_ATTR_01 = #{pushType}, t.T_ATTR_04 = #{messagePushType}, t.OBJECT_TYPE = #{objectType}
		   , t.PUSH_TEXT = #{pushText}, t.T_ATTR_13 =lnk_blank_str_to_null(#{startTime,jdbcType=TIMESTAMP})
		   , t.T_ATTR_14 = lnk_blank_str_to_null(#{expireTime,jdbcType=TIMESTAMP}), t.PUSH_FLG = #{isPushed}
		   , t.ACTIVE_FLAG = #{activeFlag}
		 where t.row_id = #{id}
	</update>
  
	<update id="brandUpdate" parameterType="com.hand.base.workbench.model.MesPush">
		update CX_O_PUSH_DTL t
		   set t.T_ATTR_01 = #{pushType}, t.T_ATTR_04 = #{messagePushType}, t.OBJECT_TYPE = #{objectType}
		   , t.PUSH_TEXT = #{pushText}, t.T_ATTR_13 =lnk_blank_str_to_null(#{startTime,jdbcType=TIMESTAMP})
		   , t.T_ATTR_14 = lnk_blank_str_to_null(#{expireTime,jdbcType=TIMESTAMP}), t.PUSH_FLG = #{isPushed}
		   , t.ACTIVE_FLAG = #{activeFlag}
		 where t.row_id = #{id}
	</update>
	
	<delete id="deleteById" parameterType="com.hand.base.workbench.model.MesPush">
		DELETE FROM CX_O_PUSH_DTL WHERE ROW_ID = #{id}
	</delete>
  	
  	<select id="queryByAllCityPage" parameterType="com.hand.base.workbench.model.MesPush" resultMap="mesPush">
  		select
		T.ROW_ID as id,
		date_format(T.CREATED,'%Y-%m-%d %H:%i:%S') as created,
		T.CREATED_BY as createdBy,
		date_format(T.LAST_UPD, '%Y-%m-%d %H:%i:%S') as lastUpdated,
		T.LAST_UPD_BY as lastUpdatedBy,
		t.CODE code,
		t.T_ATTR_02 isO2OArea,
		t.T_ATTR_01 isO2ODistrict,
		t.NAME name,
		t.PARENT_ID parentId,
		t1.NAME parentName
		from CX_O_AREA t
		LEFT JOIN CX_O_AREA t1 on t1.row_id=t.PARENT_ID
		order by t.CREATED desc
  	</select>
  
</mapper>