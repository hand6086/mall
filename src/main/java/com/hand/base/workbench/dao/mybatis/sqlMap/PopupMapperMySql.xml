<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hand.base.workbench.dao.mybatis.mapper.PopupMapper">
	<resultMap type="com.hand.base.workbench.model.Popup" id="popup"></resultMap>

	<sql id="queryAllSql">
		select
		T.ROW_ID            as id,
		date_format(T.CREATED,'%Y-%m-%d %H:%i:%S') as created,
		T.CREATED_BY        as createdBy,
		date_format(T.LAST_UPD, '%Y-%m-%d %H:%i:%S') as lastUpdated,
		T.LAST_UPD_BY       as lastUpdatedBy,
	    t.IMAGE_COMMENTS imageComments,
		t.OBJECT_TYPE objectType,
		t.DISPLAY_FLAG displayFlag,
		date_format(t.START_TIME, '%Y-%m-%d %H:%i:%S') as startTime,
		date_format(t.END_TIME, '%Y-%m-%d %H:%i:%S') as endTime,
		t.SEQUENCE sequence,
		t.CITY_ID cityId,
		t1.name cityName,
		t.IMAGE_ID imageId,
		t3.path linePath,
		t2.row_id orgId
	</sql>

	<sql id="fromSql">
		from CX_O_POPUP_IMG t
		left join (CX_O_AREA t1  LEFT JOIN lnk_org_ext T2 ON T2.ROW_ID = T1.T_ATTR_05) on t1.row_id = t.CITY_ID
		left join CX_O_IMG t3 on t3.row_id = t.IMAGE_ID
  	</sql>
  	
  	<sql id="whereAllSql">
  		where 1 = 1
  	</sql>
  	
  	<select id="queryByExamplePage" parameterType="com.hand.base.workbench.model.Popup" resultMap="popup">
  		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		<include refid="whereAllSql"/>
		order by t.CREATED desc
  	</select>
  	
  	 	
	<select id="queryById" resultType="com.hand.base.workbench.model.Popup"
		parameterType="com.hand.base.workbench.model.Popup">		
		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		where t.ROW_ID=#{id}
	</select>
  	
  	<insert id="insert" parameterType="com.hand.base.workbench.model.Popup">
		insert into CX_O_POPUP_IMG
		  (ROW_ID, IMAGE_COMMENTS, OBJECT_TYPE,DISPLAY_FLAG,START_TIME,END_TIME,SEQUENCE,CITY_ID)
		values
		  (#{id},#{imageComments},#{objectType},#{displayFlag},lnk_blank_str_to_null(#{startTime,jdbcType=TIMESTAMP}),
		  lnk_blank_str_to_null(#{endTime,jdbcType=TIMESTAMP}),lnk_blank_str_to_null(#{sequence,jdbcType=FLOAT}),#{cityId})
	</insert>
  
	<update id="update" parameterType="com.hand.base.workbench.model.Popup">
		update CX_O_POPUP_IMG t
		   set t.IMAGE_COMMENTS = #{imageComments}, t.OBJECT_TYPE = #{objectType}, t.DISPLAY_FLAG = #{displayFlag}
		   , t.START_TIME = lnk_blank_str_to_null(#{startTime,jdbcType=TIMESTAMP}), 
		   t.END_TIME = lnk_blank_str_to_null(#{endTime,jdbcType=TIMESTAMP}),
		    t.SEQUENCE = lnk_blank_str_to_null(#{sequence,jdbcType=FLOAT})
		 where t.row_id = #{id}
	</update>
	
	<delete id="deleteById" parameterType="com.hand.base.workbench.model.Popup">
		DELETE FROM CX_O_POPUP_IMG WHERE ROW_ID = #{id}
	</delete>
  	
  	<update id="popupImageUpdate" parameterType="com.hand.base.workbench.model.Popup">
	 	UPDATE CX_O_POPUP_IMG t
		   SET t.IMAGE_ID = #{imageId}
		 WHERE t.row_id = #{id}
    </update>
  
</mapper>