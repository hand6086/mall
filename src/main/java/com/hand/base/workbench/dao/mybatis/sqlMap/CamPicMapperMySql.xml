<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hand.base.workbench.dao.mybatis.mapper.CamPicMapper">
	<resultMap type="com.hand.base.workbench.model.CamPic" id="camPic"></resultMap>

	<sql id="queryAllSql">
		select
		T.ROW_ID            as id,
		date_format(T.CREATED,'%Y-%m-%d %H:%i:%S') as created,
		T.CREATED_BY        as createdBy,
		date_format(T.LAST_UPD, '%Y-%m-%d %H:%i:%S') as lastUpdated,
		T.LAST_UPD_BY       as lastUpdatedBy,
	    t.T_ATTR_01 lineType,
		t1.O2O_DISPLAY_NAME prodName,
		t1.O2O_INT_CODE prodCode,
		t2.NAME promotionName,
		t3.NAME promotionCity,
		t2.START_TIME promotionStartTime,
		t2.END_TIME promotionEndTime,
		round(t.DISPLAY_SEQ) displaySeq,
		t.STATUS status,
		t.PROD_ID prodId,
		t.T_ATTR_03 promotionId,
		t2.CITY_ID promotionCityId,
		t4.path picUrl,
		t.CAM_ID camId

	</sql>

	<sql id="fromSql">
		from CX_O_CAM_LINE t
		LEFT JOIN S_PROD_INT_X t1 on t1.PAR_ROW_ID=t.PROD_ID
		LEFT JOIN CX_O_PMO_SP t2 on t2.ROW_ID=t.T_ATTR_03
		LEFT JOIN CX_O_AREA t3 on t3.ROW_ID=t2.CITY_ID
		LEFT JOIN CX_O_IMG t4 on t4.ROW_ID=t.PIC_ID

  	</sql>
  	
  	<sql id="whereAllSql">
  		where 1 = 1
  	</sql>
  	
  	<select id="queryByExamplePage" parameterType="com.hand.base.workbench.model.CamPic" resultMap="camPic">
  		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		<include refid="whereAllSql"/>
		order by t.CREATED desc
  	</select>
  	
  	 	
	<select id="queryById" resultType="com.hand.base.workbench.model.CamPic"
		parameterType="com.hand.base.workbench.model.CamPic">		
		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		where t.ROW_ID=#{id}
	</select>
  	
  	<insert id="insert" parameterType="com.hand.base.workbench.model.CamPic">
		insert into CX_O_CAM_LINE
		  (ROW_ID, T_ATTR_01, DISPLAY_SEQ,STATUS, PROD_ID,T_ATTR_03,CAM_ID)
		values
		  (#{id},#{lineType},lnk_blank_str_to_null(#{displaySeq,jdbcType=FLOAT}),#{status},#{prodId},#{promotionId},#{camId})
	</insert>
  
	<update id="update" parameterType="com.hand.base.workbench.model.CamPic">
		update CX_O_CAM_LINE t
		   set t.T_ATTR_01 = #{lineType}, t.DISPLAY_SEQ = lnk_blank_str_to_null(#{displaySeq,jdbcType=FLOAT}), t.STATUS = #{status}
		   , t.PROD_ID = #{prodId}, t.T_ATTR_03 = #{promotionId}
		 where t.row_id = #{id}
	</update>
	
	<delete id="deleteById" parameterType="com.hand.base.workbench.model.CamPic">
		DELETE FROM CX_O_CAM_LINE WHERE ROW_ID = #{id}
	</delete>
  	
  	<select id="queryActivityCount" resultType="java.lang.Integer" parameterType="com.hand.base.workbench.model.CamPic">
		select count(*)
		FROM CX_O_CAM_LINE t1 
		where 1 = 1
		and t1.T_ATTR_01 = 'Second Kill'
		and t1.status = 'Active'
		and t1.cam_id = #{camId}
		and t1.row_id != #{id}
	</select>
	
  	<select id="queryBySecKillPage" parameterType="com.hand.base.workbench.model.CamPic" resultMap="camPic">
  		select
		T.ROW_ID            as id,
		date_format(T.CREATED,'%Y-%m-%d %H:%i:%S') as created,
		T.CREATED_BY        as createdBy,
		date_format(T.LAST_UPD, '%Y-%m-%d %H:%i:%S') as lastUpdated,
		T.LAST_UPD_BY       as lastUpdatedBy,
	    t.CITY_ID cityId, 
		t1.name city,
		t.END_TIME endTime,
		t.NAME name,
		t.NOTES notes,
		t.START_TIME startTime
		from CX_O_PMO_SP t
		LEFT JOIN CX_O_AREA t1 on t1.row_id=t.CITY_ID
		order by t.CREATED desc
  	</select>
  
</mapper>