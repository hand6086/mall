<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hand.base.workbench.dao.mybatis.mapper.CampaignLineMapper">
	<resultMap type="com.hand.base.workbench.model.Campaign" id="campaign"></resultMap>
	
	<sql id="queryAllSql">
	SELECT
	T.ROW_ID as id,
	date_format(T.CREATED,'%Y-%m-%d %H:%i:%S') as created,
	T.CREATED_BY as createdBy,
	date_format(T.LAST_UPD, '%Y-%m-%d %H:%i:%S') as lastUpdated,
	T.LAST_UPD_BY as lastUpdatedBy,
	T.corp_id      as corpId,
	t.T_ATTR_01 lineType,
	t1.O2O_DISPLAY_NAME prodName,
	t1.O2O_INT_CODE prodCode,
	t2.NAME couponName,
	t2.CODE couponCode,
	round(t.DISPLAY_SEQ) displaySeq,
	t.STATUS status,
	t.CAM_ID camId,
	t.T_ATTR_06 camType,
	t.COUPON_ID couponId,
	t.T_ATTR_03 promotionId,
	t7.NAME promotionName,
	t7.START_TIME promotionStartTime,
	t7.END_TIME promotionEndTime,
	t7.CITY_ID promotionCityId,
	t.IS_DISPLAY isDisplay,
	t.PIC_ID picId,
	t6.path picUrl,
	t.PROD_ID prodId,
	t5.row_id orgId,
	t.url url
	</sql>

	<sql id="fromSql">
	from CX_O_CAM_LINE t
	LEFT JOIN S_PROD_INT_X t1 on t1.row_id=t.PROD_ID
	LEFT JOIN CX_O_PMO_SP t2 on t2.row_id=t.COUPON_ID
	LEFT JOIN CX_O_PMO_SP t7 on t7.ROW_ID=t.T_ATTR_03
	left join CX_O_CAMPAIGN t3 on t3.row_id = t.CAM_ID
	LEFT JOIN CX_O_IMG t6 on t6.ROW_ID=t.PIC_ID
	LEFT JOIN (CX_O_AREA t4  LEFT JOIN lnk_org_ext T5 ON T5.ROW_ID = T4.T_ATTR_05) on t4.ROW_ID=t3.T_ATTR_06
  	</sql>
  	
  	<sql id="whereAllSql">
  		where 1 = 1
  	</sql>
  	
  	<select id="queryByExamplePage" parameterType="com.hand.base.workbench.model.Campaign" resultMap="campaign">
  		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		<include refid="whereAllSql"/>
		order by t.CREATED desc
  	</select>
  	
  	<select id="brandQueryByExamplePage" parameterType="com.hand.base.workbench.model.Campaign" resultMap="campaign">
  		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		<include refid="whereAllSql"/>
		<if test=" attr6 == 'datail' ">
		and t.CAM_ID = #{camId}
		</if>
		order by t.CREATED desc
  	</select>
  	
	<select id="queryById" resultType="com.hand.base.workbench.model.Campaign"
		parameterType="com.hand.base.workbench.model.Campaign">		
		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		where t.ROW_ID=#{id}
	</select>
  	
	<select id="brandQueryById" resultType="com.hand.base.workbench.model.Campaign"
		parameterType="com.hand.base.workbench.model.Campaign">		
		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		where t.ROW_ID=#{id}
	</select>
  	
  	<insert id="insert" parameterType="com.hand.base.workbench.model.Campaign">
		insert into CX_O_CAM_LINE
		  (ROW_ID, T_ATTR_01 , DISPLAY_SEQ, STATUS , COUPON_ID, PROD_ID,CAM_ID,PIC_ID)
		values
		  (#{id},#{lineType},lnk_blank_str_to_null(#{displaySeq,jdbcType=FLOAT}),#{status},#{couponId},#{prodId},#{camId},#{picId})
	</insert>
  
	<update id="update" parameterType="com.hand.base.workbench.model.Campaign">
		update CX_O_CAM_LINE t
		   set t.T_ATTR_01 = #{lineType}, t.DISPLAY_SEQ = lnk_blank_str_to_null(#{displaySeq,jdbcType=FLOAT})
		   ,t.STATUS = #{status}, t.COUPON_ID = #{couponId},t.PROD_ID = #{prodId}
		 where t.row_id = #{id}
	</update>
	
  	<insert id="brandInsert" parameterType="com.hand.base.workbench.model.Campaign">
		insert into CX_O_CAM_LINE
		  (ROW_ID, T_ATTR_01 , DISPLAY_SEQ, STATUS , COUPON_ID,T_ATTR_03, PROD_ID,CAM_ID,PIC_ID,url)
		values
		  (#{id},#{lineType},lnk_blank_str_to_null(#{displaySeq,jdbcType=FLOAT}),#{status},#{couponId},#{promotionId},#{prodId},#{camId},#{picId},#{url})
	</insert>
  
	<update id="brandUpdate" parameterType="com.hand.base.workbench.model.Campaign">
		update CX_O_CAM_LINE t
		   set t.T_ATTR_01 = #{lineType}, t.DISPLAY_SEQ = lnk_blank_str_to_null(#{displaySeq,jdbcType=FLOAT})
		   ,t.STATUS = #{status},t.T_ATTR_03 = #{promotionId}, t.COUPON_ID = #{couponId},t.PROD_ID = #{prodId},t.url = #{url}
		 where t.row_id = #{id}
	</update>
	
	<delete id="deleteById" parameterType="com.hand.base.workbench.model.Campaign">
		DELETE FROM CX_O_CAM_LINE WHERE ROW_ID = #{id}
	</delete>
  	
</mapper>