<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hand.base.workbench.dao.mybatis.mapper.SmsLineMapper">
	<resultMap type="com.hand.base.workbench.model.SmsSend" id="smsSend"></resultMap>

	<sql id="queryAllSql">
		select
		T.ROW_ID            as id,
		date_format(T.CREATED,'%Y-%m-%d %H:%i:%S') as created,
		T.CREATED_BY        as createdBy,
		date_format(T.LAST_UPD, '%Y-%m-%d %H:%i:%S') as lastUpdated,
		T.LAST_UPD_BY       as lastUpdatedBy,
	    t.HEAD_ID headId,
		t.PHONE_NUMBER phoneNumber,
		t.T_ATTR_03 sendLotId,
		t1.DATE_CREATED dateCreated,
		t1.STATUS_CODE statusCode,
		t1.STATUS_MSG statusMessage,
		t1.T_ATTR_05 sendTime,
		t1.T_ATTR_04 sendStatus,
		t.T_ATTR_04 receiveTime,
		t.T_ATTR_05 receiveStatus,
		t.SEND_FLAG backFlag
	</sql>

	<sql id="fromSql">
		from CX_O_SMS_SE_LN t
		LEFT JOIN CX_O_SMS_SE_LOT t1 on t1.ROW_ID=t.T_ATTR_03
  	</sql>
  	
  	<sql id="whereAllSql">
  		where 1 = 1
  		<if test=" attr1 == 'smsReturn' ">
  			and (
  				 (t1.STATUS_CODE='000000' and (t.SEND_FLAG != 'Y' or t.SEND_FLAG is null))
  				 or (t1.STATUS_CODE='111111' and t.SEND_FLAG = 'Y')
  				 or (t1.STATUS_CODE='112356' and t.SEND_FLAG = 'Y')
  				)
  			and t.HEAD_ID = #{headId}
  		</if>
  	</sql>
  	
  	<select id="queryByExamplePage" parameterType="com.hand.base.workbench.model.SmsSend" resultMap="smsSend">
  		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		<include refid="whereAllSql"/>
		order by t.CREATED desc
  	</select>
  	
  	 	
	<select id="queryById" resultType="com.hand.base.workbench.model.SmsSend"
		parameterType="com.hand.base.workbench.model.SmsSend">		
		<include refid="queryAllSql"/>
		<include refid="fromSql"/>
		where t.ROW_ID=#{id}
	</select>
  	
  	<insert id="insert" parameterType="com.hand.base.workbench.model.SmsSend">
		insert into CX_O_SMS_SE_LN
		  (ROW_ID, PHONE_NUMBER , T_ATTR_03, T_ATTR_04 , T_ATTR_05, SEND_FLAG, HEAD_ID )
		values
		  (#{id},#{phoneNumber},#{sendLotId},#{receiveTime},#{receiveStatus},#{backFlag},#{headId})
	</insert>
  
	<update id="update" parameterType="com.hand.base.workbench.model.SmsSend">
		update CX_O_SMS_SE_LN t
		   set t.row_id = #{id}
		   <if test="headId !=null and headId !=''">
		   ,t.HEAD_ID = #{headId}
		   </if>
		   <if test="phoneNumber !=null and phoneNumber !=''">
		   , t.PHONE_NUMBER = #{phoneNumber}
		   </if>
		   <if test="sendLotId !=null and sendLotId !=''">
		   , t.T_ATTR_03 = #{sendLotId}
		   </if>
		   <if test="receiveTime !=null and receiveTime !=''">
		   ,t.T_ATTR_04 = #{receiveTime}
		   </if>
		   <if test="receiveStatus !=null and receiveStatus !=''">
		   , t.T_ATTR_05 = #{receiveStatus}
		   </if>
		   <if test="backFlag !=null and backFlag !=''">
		   ,t.SEND_FLAG = #{backFlag}
		   </if>
		 where t.row_id = #{id}
	</update>
	
	<delete id="deleteById" parameterType="com.hand.base.workbench.model.SmsSend">
		DELETE FROM CX_O_SMS_SE_LN WHERE ROW_ID = #{id}
	</delete>
  	
  
</mapper>