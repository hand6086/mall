<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hand.base.promotion.dao.mybatis.mapper.GroupUserMapper">
  <resultMap type="com.hand.base.promotion.model.GroupUser" id="groupUser"></resultMap>
	<sql id="querySchemaSql">
		SELECT
			t1.ROW_ID id,
			date_format(t1.CREATED,'%Y-%m-%d %H:%i:%S') created,/*入团时间*/
			t1.CREATED_BY createdBy,
			date_format(t1.last_upd,'%Y-%m-%d %H:%i:%S') lastUpdated,
			t1.LAST_UPD_BY lastUpdatedBy,
			t1.CORP_ID corpid,
			t1.group_id groupId,/*团ID*/
			t1.customer_id customerId,/**/
			t1.found_flg foundFlg,/*是否发起人*/
			t1.pay_flg payFlg,/*是否支付*/
			t2.row_id customerCode,/*消费者编码*/
			t2.MAIN_PH_NUM phoneNumber,/*消费者电话*/
			t2. NAME customerName, /*消费者名称*/
			IFNULL(t3.order_num,t4.order_num) orderNum /*订单编号*/
	</sql>
	
	<sql id="fromSchemaSql">
		FROM
			lnk_group_user t1
		LEFT JOIN lnk_accnt t2 ON t2.row_id = t1.customer_id
		LEFT JOIN s_order_x t3 on t3.row_id = t1.order_id
		LEFT JOIN s_order t4 on t4.row_id = t1.order_id
	</sql>
	
	<sql id="whereSchemaSql">
		WHERE 1 = 1
	</sql>

	<select id="queryByExamplePage" resultMap="groupUser" parameterType="com.hand.base.promotion.model.GroupUser">
		<include refid="querySchemaSql"/>
		<include refid="fromSchemaSql"/>
		<include refid="whereSchemaSql"/>
		order by t1.CREATED desc
	</select>
	
	<select id="queryById" resultMap="groupUser" parameterType="com.hand.base.promotion.model.GroupUser">
		<include refid="querySchemaSql"/>
		<include refid="fromSchemaSql"/>
		<include refid="whereSchemaSql"/>
		AND t1.ROW_ID=#{id}
	</select>
	
</mapper>