<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hand.base.promotion.dao.mybatis.mapper.PromotionMapper">

	<resultMap type="com.hand.base.promotion.model.Promotion" id="promotion"></resultMap>

	<sql id="queryAllSql">
		SELECT
		t1.ROW_ID id,/*与子级相关字段*/
		t1.CREATED created,
		t1.CREATED_BY createdBy,
		date_format(t1.LAST_UPD,'%Y-%m-%d %H:%i:%s') lastUpdated,
		t1.LAST_UPD_BY lastUpdatedBy,
		t1.CORP_ID corpid,
		t1.CITY_ID cityId,
		t4.fst_name createdName,
		t1.NAME activityName,/*促销活动名称*/
		t1.CODE activityCode,/*促销活动编码*/
		date_format(t1.start_time,'%Y-%m-%d %H:%i:%S') startTime,/*活动开始时间*/
		date_format(t1.end_time,'%Y-%m-%d %H:%i:%S') endTime,/*活动结束时间*/
		t1.STATUS status,/*活动状态*/
		t1.TYPE type,/*促销形式*/
		t1.NOTES activityNotes,/*说明*/
		t1.T_ATTR_03 noCouponUse,/*是否可用优惠券*/
		t2.name cityName,/*大区*/
		t1.approval_status approvalStatus,/*审批状态*/
		t1.approval_suggest approvalSuggest,/*审批意见*/
		t1.schema_id schemaId, /*活动方案ID*/
		t5.APPROVAL_FLG approvalFlg,/*活动自动审批*/
		t3.row_id orgId,
		t6.lmt_b_info lmtBInfo /*限购信息*/
	</sql>

	<sql id="fromTableSql">
		FROM CX_O_PMO_SP t1
		left join (
			CX_O_AREA t2 LEFT JOIN lnk_org_ext t3 ON t3.ROW_ID = t2.T_ATTR_05
			) on t1.CITY_ID= t2.ROW_ID
		LEFT JOIN lnk_emp_info t4 on t1.CREATED_BY = t4.row_id
		left join LNK_SALE_SCHEMA t5 on t1.schema_id = t5.row_id
		LEFT JOIN cx_o_pmo_sp_ln t6 ON t1.row_id = t6.head_id
	</sql>

	<sql id="whereAllSql">
		where 1=1
		AND t1.delete_flg != 'Y'
		and t1.SOURCE = 'fast shopping'
		<if test="type != null and type != '' ">
		<!--
			<if test="type == 'Free Buy' ">
				and t1.TYPE='Free Buy'
			</if>
			<if test="type == 'Limited Purchase' ">
				and t1.TYPE='Limited Purchase'
			</if>
			<if test="type == 'Second Kill' ">
				and t1.TYPE='Second Kill'
			</if>
		 -->
			AND t1.type = #{type}

		</if>
		<if test="usersystemRole != 'super_administrator' ">
			and t1.corp_id = #{usercorpid}
		</if>
		<if test="id != null and id != ''">
			AND t1.ROW_ID = #{id}
		</if>
		<!-- 审批界面 -->
		<if test="isApproved == 'Approved' ">
			AND t1.approval_status != 'New'
			order by FIELD(t1.approval_status,'Pending','Rejected','Approved'),t1.CREATED desc
		</if>
		
		<if test="attr1 == 'Schema' ">
			order by FIELD(t1.approval_status,'Rejected','Pending','New','Approved'),t1.CREATED desc
		</if>
		
		<if test="type != '' and type != null and isApproved != 'Approved' and attr1 != 'Schema' ">
			order by t1.CREATED desc
		</if>

	</sql>

	<select id="queryByExamplePage" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		<include refid="queryAllSql" />
		<include refid="fromTableSql" />
		<include refid="whereAllSql" />
	</select>
	
	<select id="brandQueryShopPromotionCount" resultType="java.lang.Integer" parameterType="com.hand.base.promotion.model.Promotion">
		SELECT count(*) 
		FROM CX_O_PMO_SP t1
		where 1=1
		AND T1.SOURCE = 'brand'
		AND t1.delete_flg != 'Y'
		<if test="id != null and id != '' ">
			and t1.row_id != #{id}
		</if>
		AND t1.corp_id = #{usercorpid}
		AND (
				 t1.brand_discount_type = 'Cash Deduction'
				 or t1.brand_discount_type = 'Reward for gifts' 
				 or t1.brand_discount_type = 'Dispatch Coupon' 
				 )
		AND ((#{startTime} BETWEEN t1.start_time AND t1.end_time)
				OR (#{endTime} BETWEEN t1.start_time AND t1.end_time)
				or (#{startTime} &lt; t1.start_time and #{endTime} >t1.end_time))
	</select>

	<sql id="queryBrandAllSql">
		SELECT
		t1.ROW_ID id,/*与子级相关字段*/
		t1.CREATED created,
		t1.CREATED_BY createdBy,
		date_format(t1.LAST_UPD,'%Y-%m-%d %H:%i:%s') lastUpdated,
		t1.LAST_UPD_BY lastUpdatedBy,
		t1.CORP_ID corpid,
		t1.CITY_ID cityId,
		t1.NAME activityName,/*促销活动名称*/
		t1.CODE activityCode,/*促销活动编码*/
		date_format(t1.start_time,'%Y-%m-%d %H:%i:%S') startTime,/*活动开始时间*/
		date_format(t1.end_time,'%Y-%m-%d %H:%i:%S') endTime,/*活动结束时间*/
		t1.STATUS status,/*状态*/
		t1.TYPE type,/*促销形式*/
		t1.NOTES activityNotes,/*说明*/
		t1.T_ATTR_03 noCouponUse,/*是否可用优惠券*/
		t1.approval_status approvalStatus,/*审批状态*/
		t1.approval_suggest approvalSuggest,/*审批意见*/
		t1.schema_id schemaId, /*活动方案ID*/
		t1.MIN_ORD_AMOUNT minOrdAmount,/*订单门槛*/
		t1.DEDUCED_CASH deducedCash, /*满减金额*/
		t3.NAME onCouponName, /*优惠券名称*/
		t4.O2O_DISPLAY_NAME freeMerchName, /*满赠商品名称*/
		t1.RELEASE_AMT releaseAmt, /* 赠送数量*/
		t1.brand_discount_type brandDiscountType, /*优惠类型*/
		t1.if_cash_deduction  ifCashDeduction,   /*是否同享满减*/
		<!-- 组合优惠  -->
		<if test="brandDiscountType != 'Combination'">
			t6.path path,/*方案图片*/
		</if>
		<!-- 组合优惠  -->
		<if test="brandDiscountType == 'Combination'">
			t8.O2O_DISPLAY_NAME buyMerchName,/*主商品名称*/
			(select t10.path from cx_o_prod_pic t9 left join cx_o_img t10 on t10.row_id = t9.pic_id where t9.prod_id = t7.MERCHANDISE_ID limit 1) path,   /*图片地址*/
		</if>
		IF (t1.brand_status = 'PAUSE','PAUSE',
				CASE
					WHEN now() &lt; T1.start_time THEN
						'NO_START'
					WHEN now() BETWEEN t1.start_time AND t1.end_time THEN
						'GOING'
					ELSE
						'END' 
					END ) brandStatus, /*单品优惠活动状态*/
		t2.store_name storeName /*店铺名称*/
	</sql>

	<sql id="fromBrandTableSql">
		FROM CX_O_PMO_SP t1
		left join lnk_enterprise t2 on t1.store_id = t2.row_id
		left join CX_O_PMO_SP t3 on  t1.COUPON_ID=t3.row_id
		left join S_PROD_INT_X t4 on  t1.T_ATTR_01=t4.row_id 
		left join (LNK_SALE_SCHEMA t5 LEFT JOIN cx_o_img t6 on t5.PIC_ID = t6.row_id ) on t1.schema_id = t5.row_id
		<!-- 组合优惠  -->
		<if test="brandDiscountType == 'Combination'">
			left join ( 
				cx_o_pmo_sp_ln t7 left join S_PROD_INT_X t8 on  t7.merchandise_id=t8.row_id 
				) on  t7.head_id = t1.row_id 
		</if>
	</sql>
	
	<sql id="whereBrandAllSql">
		where 1=1
		AND T1.SOURCE = 'brand'
		AND t1.delete_flg != 'Y'
		<if test="usersystemRole != 'super_administrator' ">
			and t1.corp_id = #{usercorpid}
		</if>
		<if test="type != null and type != '' ">
			AND t1.type = #{type}
		</if>
		<!-- 单品优惠 -->
		<if test="brandDiscountType == 'product'">
			AND (
				 t1.brand_discount_type = 'Bargain_Price'
				 or t1.brand_discount_type = 'Discount' 
				 or t1.brand_discount_type = 'BOFO' 
				 )
		</if>
		
		<!-- 店铺优惠  -->
		<if test="brandDiscountType == 'store'">
			AND (
				 t1.brand_discount_type = 'Cash Deduction'
				 or t1.brand_discount_type = 'Reward for gifts' 
				 or t1.brand_discount_type = 'Dispatch Coupon' 
				 )
		</if>
		
		<!-- 组合优惠  is_home_prod = Y 代表组合商品的主商品-->
		<if test="brandDiscountType == 'Combination'">
			AND t1.brand_discount_type = 'Combination'
			AND t7.is_home_prod = 'Y'
		</if>
		<!-- 审批界面 -->
		<if test="isApproved != '' and isApproved != null ">
			AND t1.approval_status != 'New'
			order by FIELD(t1.approval_status,'Pending','Rejected','Approved'),t1.CREATED desc
		</if>
		<if test="isApproved == '' or isApproved == null ">
			order by FIELD(t1.approval_status,'Rejected','Pending','New','Approved'),t1.CREATED desc
		</if>
	</sql>
	
	<select id="brandQueryByExamplePage" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		<include refid="queryBrandAllSql" />
		<include refid="fromBrandTableSql" />
		<include refid="whereBrandAllSql" />
	</select>
	
	<select id="brandQueryBySchemaId" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		<include refid="queryBrandAllSql" />
		<include refid="fromBrandTableSql" />
		where 1=1
		and t1.source = 'brand'
		AND t1.delete_flg != 'Y'
		<if test="usersystemRole != 'super_administrator' ">
			and t1.corp_id = #{usercorpid}
		</if>
		and t1.schema_id=#{schemaId}
	</select>
	
	<select id="brandQueryById" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		<include refid="queryBrandAllSql" />
		<include refid="fromBrandTableSql" />
		where T1.ROW_ID=#{id}
		AND t1.delete_flg != 'Y'
		<if test="brandDiscountType == 'Combination'">
			AND t1.brand_discount_type = 'Combination'
			AND t7.is_home_prod = 'Y'
		</if>
	</select>
	<select id="queryStoreInfoByCode" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		SELECT
			row_id storeId,
			created created,
			created_by createdBy,
			last_upd lastUpd,
			last_upd_by lastUpdBy,
			corp_id corpId,
			store_name storeName
		FROM
			lnk_enterprise
		WHERE
			CODE = #{usercorpid}
	</select>

	<select id="queryById" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		<include refid="queryAllSql" />
		<include refid="fromTableSql" />
		where T1.ROW_ID=#{id}
		AND t1.delete_flg != 'Y'
	</select>
	
	<select id="queryAll" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		<include refid="queryAllSql" />
		<include refid="fromTableSql" />
		<include refid="whereAllSql" />
	</select>

	<select id="queryCityPage" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		SELECT
			t4.NOTES cityNotes,
			t3.NAME cityName,
			t4.CITY_ID id,
			t5.NAME name,
			t3.T_ATTR_05 orgId
		FROM
			LNK_INTER_CITY_SALE t1
		LEFT JOIN LNK_SALE_SCHEMA t2 ON t1.sale_schema_id = t2.row_id
		LEFT JOIN ( CX_O_AREA t3 LEFT JOIN CX_O_CITY t4 ON t3.row_id = t4.CITY_ID
					LEFT JOIN CX_O_AREA t5 ON t5.ROW_ID = t3.PARENT_ID
					) ON t1.city_id = t3.row_id
		WHERE 1 = 1
		AND t3.T_ATTR_02 = 'Y'
		AND t3. NAME != ''
		AND t2.row_id=#{schemaId}
		order by t1.CREATED desc
	</select>
	
	<select id="queryType" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		select
			t3.row_id id,
			t3.NAME name,/*促销形式*/
			t3.val val
		from lnk_inter_type_sale t1 left join LNK_SALE_SCHEMA t2 on t1.sale_schema_id = t2.row_id
		left join lnk_list_of_val t3 on t1.type_id = t3.row_id
		where 1=1
			and t1.sale_schema_id = #{schemaId}
	</select>

	<insert id="insert" parameterType="com.hand.base.promotion.model.Promotion">
  		INSERT INTO cx_o_pmo_sp(
		   ROW_ID, 
		   city_id,
           name,
           code,
		   start_time,
		   end_time,
		   type,
		   STATUS,
		   approval_status,
		   approval_suggest,
		   notes,
		   COST_SHARE_PPT_D,
		   COST_SHARE_MAX_D,
		   COST_SHARE_MIN_D,
		   COST_SHARE_PPT_W,
		   COST_SHARE_MAX_W,
		   COST_SHARE_MIN_W,
		   COST_SHARE_PPT_R,
		   COST_SHARE_MAX_R,
		   COST_SHARE_MIN_R,
		   schema_id,
		   source,
		   delete_flg,
		   T_ATTR_03
		   )
		VALUES(
		   #{id},
		   #{cityId},
		   #{activityName},
		   TB_O2O_ACCTIVITYCODE(),
		   #{startTime},
		   #{endTime},
		   #{type},
		   #{status},
		   #{approvalStatus},
		   #{approvalSuggest},
		   #{activityNotes},
		   #{costProportionD},
		   #{costMaxProportionD},
		   #{costMinProportionD},
		   #{costProportionW},
		   #{costMaxProportionW},
		   #{costMinProportionW},
		   #{costProportionR},
		   #{costMaxProportionR},
		   #{costMinProportionR},
		   #{schemaId},
		   'fast shopping',
		   'N',
		   <if test="noCouponUse != '' and noCouponUse != null ">
		   	  #{noCouponUse}
		   	  <!-- GET_LOV_VAL(#{usercorpid}, 'TB_O2O_COUPON_USE',#{noCouponUse}) ); -->
		   </if>
		   <!-- 促销方案 新建拼团活动时 使优惠券默认不可用 -->
		   <if test="noCouponUse == '' or noCouponUse == null ">
		   	  'N'
		   </if>
		   )
	</insert>
	
	<insert id="brandInsert" parameterType="com.hand.base.promotion.model.Promotion">
  		INSERT INTO cx_o_pmo_sp(
		   ROW_ID, 
           name,
           code,
		   start_time,
		   end_time,
		   type,
		   STATUS,
		   approval_status,
		   approval_suggest,
		   notes,
		   schema_id,
		   source,
		   store_id,
		   brand_discount_type,
		   brand_status,
		   MIN_ORD_AMOUNT,
		   DEDUCED_CASH,
		   COUPON_ID,
		   t_attr_01,
		   RELEASE_AMT,
		   comments,
		   delete_flg,
		   if_cash_deduction,
		   T_ATTR_03
		   )
		VALUES(
		   #{id},
		   #{activityName},
		   TB_O2O_ACCTIVITYCODE(),
		   #{startTime},
		   #{endTime},
		   #{type},
		   #{status},
		   #{approvalStatus},
		   #{approvalSuggest},
		   #{activityNotes},
		   #{schemaId},
		   'brand',
		   #{storeId},
		   #{brandDiscountType},
		   #{brandStatus},
		   #{minOrdAmount},
		   #{deducedCash},
		   #{couponId},
		   #{freeMerchId},
		   #{releaseAmt},
		   #{comments},
		   'N',
		   #{ifCashDeduction},
		   <if test="noCouponUse != '' and noCouponUse != null ">
		   	  #{noCouponUse}
		   </if>
		   <if test="noCouponUse == '' or noCouponUse == null ">
		   	  'N'
		   </if>
		   )
	</insert>

	<update id="brandUpdate" parameterType="com.hand.base.promotion.model.Promotion">
		UPDATE cx_o_pmo_sp
  		SET 
  		   row_id = #{id}
  		   <if test="activityName != null and activityName != '' ">
         	  ,name = #{activityName}
  		   </if>
  		   <if test="activityCode != null and activityCode != '' ">
         	  ,code = #{activityCode}
  		   </if>
  		   <if test="startTime != null and startTime != '' ">
         	  ,start_time = #{startTime}
  		   </if>
  		   <if test="endTime != null and endTime != '' ">
         	  ,end_time = #{endTime}
  		   </if>
  		   <if test="type != null and type != '' ">
         	  ,type = #{type}
  		   </if>
  		   <if test="status != null and status != '' ">
         	  ,STATUS = #{status}
  		   </if>
  		   <if test="approvalStatus != null and approvalStatus != '' ">
         	  ,approval_status = #{approvalStatus}
  		   </if>
  		   <if test="approvalSuggest != null and approvalSuggest != '' ">
         	  ,approval_suggest = #{approvalSuggest}
  		   </if>
  		   <if test="activityNotes != null and activityNotes != '' ">
         	  ,notes = #{activityNotes}
  		   </if>
  		   <if test="brandDiscountType != null and brandDiscountType != '' ">
         	  ,brand_discount_type = #{brandDiscountType}
  		   </if>
  		   <if test="brandStatus != null and brandStatus != '' ">
         	  ,brand_status = #{brandStatus}
  		   </if>
  		   <if test="minOrdAmount != null and minOrdAmount != '' ">
         	  ,MIN_ORD_AMOUNT = #{minOrdAmount}
  		   </if>
  		   <if test="deducedCash != null and deducedCash != '' ">
         	  ,DEDUCED_CASH = #{deducedCash}
         	  ,t_attr_01 = null
         	  ,COUPON_ID = null
  		   </if>
  		   <if test="freeMerchId != null and freeMerchId != '' ">
         	  ,t_attr_01 = #{freeMerchId}
         	  ,DEDUCED_CASH = null
         	  ,COUPON_ID = null
  		   </if>
  		   <if test="couponId != null and couponId != '' ">
         	  ,COUPON_ID = #{couponId}
         	  ,t_attr_01 = null
         	  ,DEDUCED_CASH = null
  		   </if>
  		   <if test="releaseAmt != null and releaseAmt != '' ">
         	  ,RELEASE_AMT = #{releaseAmt}
  		   </if>
  		   <if test="noCouponUse != null and noCouponUse != '' ">
         	  ,T_ATTR_03 = #{noCouponUse}
  		   </if>
  		   <if test="deleteFlg != null and deleteFlg != '' ">
         	  ,delete_flg = #{deleteFlg}
  		   </if>
		WHERE ROW_ID = #{id}

	</update>
	<update id="update" parameterType="com.hand.base.promotion.model.Promotion">
		UPDATE cx_o_pmo_sp
  		SET 
		   city_id=#{cityId},
           name=#{activityName},
		   start_time=#{startTime},
		   end_time=#{endTime},
		   type=#{type},
		   STATUS=#{status},
		   approval_status=#{approvalStatus},
		   approval_suggest=#{approvalSuggest},
		   notes=#{activityNotes},
		   T_ATTR_03=#{noCouponUse}
		   <if test="deleteFlg != null and deleteFlg != '' ">
         	  ,delete_flg  		   =#{deleteFlg}        
  		   </if>
		   <if test="costProportionD != null and costProportionD != ''">
		   ,COST_SHARE_PPT_D = #{costProportionD}
		   </if>
		   <if test="costMaxProportionD != null and costMaxProportionD != ''">
		   ,COST_SHARE_MAX_D = #{costMaxProportionD}
		   </if>
		   <if test="costMinProportionD != null and costMinProportionD != ''">
		   ,COST_SHARE_MIN_D = #{costMinProportionD}
		   </if>
		   <if test="costProportionW != null and costProportionW != ''">
		   ,COST_SHARE_PPT_W = #{costProportionW}
		   </if>
		   <if test="costMaxProportionW != null and costMaxProportionW != ''">
		   ,COST_SHARE_MAX_W = #{costMaxProportionW}
		   </if>
		   <if test="costMinProportionW != null and costMinProportionW != ''">
		   ,COST_SHARE_MIN_W = #{costMinProportionW}
		   </if>
		   <if test="costProportionR != null and costProportionR != ''">
		   ,COST_SHARE_PPT_R = #{costProportionR}
		   </if>
		   <if test="costMaxProportionR != null and costMaxProportionR != ''">
		   ,COST_SHARE_MAX_R = #{costMaxProportionR}
		   </if>
		   <if test="costMinProportionR != null and costMinProportionR != ''">
		   ,COST_SHARE_MIN_R = #{costMinProportionR}
		   </if>
		WHERE ROW_ID = #{id}

	</update>
	
	<update id="batchUpdateStatus" parameterType="com.hand.base.promotion.model.Promotion">
		UPDATE cx_o_pmo_sp
  		SET 
		   STATUS=#{status}
		WHERE SCHEMA_ID = #{schemaId}
		<if test="status == 'Active' ">
			and approval_status=#{approvalStatus}
		</if>

	</update>
	
	<update id="updateStatusBySchemaId" parameterType="com.hand.base.promotion.model.Promotion">
		UPDATE cx_o_pmo_sp
  		SET 
		   STATUS='Inactive',
		   DELETE_FLG='Y'
		WHERE SCHEMA_ID = #{schemaId}
	</update>

	<delete id="deleteById" parameterType="com.hand.base.promotion.model.Promotion">
		DELETE FROM CX_O_PMO_SP
		WHERE ROW_ID=#{id}

	</delete>

	<select id="querygoods" resultMap="promotion" parameterType="com.hand.base.promotion.model.Promotion">
		SELECT 
			t1.product_id buyMerchId
			from LNK_INTER_PRODUCT_SALE t1
			LEFT JOIN LNK_SALE_SCHEMA t2 ON t1.sale_schema_id = t2.row_id
			LEFT JOIN (
						S_PROD_INT t3
						LEFT JOIN S_PROD_INT_X t4 ON t3.ROW_ID = t4.PAR_ROW_ID
					) ON t1.product_id = t3.row_id
			where 1=1
			and t1.sale_schema_id = #{schemaId}
			<if test="attr1 == 'Combination' ">
			and t4.ATTRIB_09 = 'Y'
			</if>
	</select>
	
	<select id="querySchemaTimeBySchemaId" resultType="com.hand.base.promotion.model.Promotion" parameterType="String">
		select t.start_date merchStartTime, t.end_date merchEndTime from LNK_SALE_SCHEMA t where t.row_id = #{schemaId}
	</select>
	
	
	<update id="updateHead" parameterType="com.hand.base.promotion.model.Promotion">
		UPDATE cx_o_pmo_sp
  		SET 
  		   row_id = #{id}
  		   <if test="activityName != null and activityName != '' ">
         	  ,name = #{activityName}
  		   </if>
  		   <if test="activityCode != null and activityCode != '' ">
         	  ,code = #{activityCode}
  		   </if>
  		   <if test="startTime != null and startTime != '' ">
         	  ,start_time = #{startTime}
  		   </if>
  		   <if test="endTime != null and endTime != '' ">
         	  ,end_time = #{endTime}
  		   </if>
  		   <if test="type != null and type != '' ">
         	  ,type = #{type}
  		   </if>
  		   <if test="status != null and status != '' ">
         	  ,STATUS = #{status}
  		   </if>
  		   <if test="approvalStatus != null and approvalStatus != '' ">
         	  ,approval_status = #{approvalStatus}
  		   </if>
  		   <if test="approvalSuggest != null and approvalSuggest != '' ">
         	  ,approval_suggest = #{approvalSuggest}
  		   </if>
  		   <if test="activityNotes != null and activityNotes != '' ">
         	  ,notes = #{activityNotes}
  		   </if>
  		   <if test="brandDiscountType != null and brandDiscountType != '' ">
         	  ,brand_discount_type = #{brandDiscountType}
  		   </if>
  		   <if test="brandStatus != null and brandStatus != '' ">
         	  ,brand_status = #{brandStatus}
  		   </if>
  		   <if test="minOrdAmount != null and minOrdAmount != '' ">
         	  ,MIN_ORD_AMOUNT = #{minOrdAmount}
  		   </if>
  		   <if test="deducedCash != null and deducedCash != '' ">
         	  ,DEDUCED_CASH = #{deducedCash}
         	  ,t_attr_01 = null
         	  ,COUPON_ID = null
  		   </if>
  		   <if test="freeMerchId != null and freeMerchId != '' ">
         	  ,t_attr_01 = #{freeMerchId}
         	  ,DEDUCED_CASH = null
         	  ,COUPON_ID = null
  		   </if>
  		   <if test="couponId != null and couponId != '' ">
         	  ,COUPON_ID = #{couponId}
         	  ,t_attr_01 = null
         	  ,DEDUCED_CASH = null
  		   </if>
  		   <if test="releaseAmt != null and releaseAmt != '' ">
         	  ,RELEASE_AMT = #{releaseAmt}
  		   </if>
  		   <if test="noCouponUse != null and noCouponUse != '' ">
         	  ,T_ATTR_03 = #{noCouponUse}
  		   </if>
  		   <if test="deleteFlg != null and deleteFlg != '' ">
         	  ,delete_flg = #{deleteFlg}
  		   </if>
		WHERE ROW_ID = #{id}
	</update>
	
</mapper>

